@page "/Battle-1"
@inject ILocalStorageService localStorage

<div class="center-container">
    <h3>Battle</h3>
    <p>Press enter to submit your answer</p>

    <!--display player and boss health-->
    <p>your health: @mainChp</p>
    <p>boss health: @enemyOnehp</p>

    <!--the question-->
    <p>@num1 + @num2 = ?</p>

    <!--the text input box and the on enter key pressed-->
    <input type="number" @bind="@userAnswer" @bind:event="oninput" @onkeydown="HandleKeyDown" />

    <!--this bit is for displaying the result, like the game over yes, skill issue stuff-->
    @if (showResult)
    {
        <p>@resultMessage</p>
    }
</div>

<!--the css styling bit lol-->
<style>
    html, body {
        overflow: hidden;
    }
    .center-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        text-align: center;
        font-family: Courier New, Courier, monospace;
    }
</style>


@code {
    //variables for both storing the uh numbers and the inputs from userrrr
    private int num1;
    private int num2;
    private int? userAnswer;
    private const string Level = "level";

    //for managing the visability of the resultsssss
    private bool showResult;
    private string resultMessage;

    //starting player and boss health
    public int mainChp = 3;
    public int enemyOnehp = 15;

    //what the thing first start this should runnn
    protected override void OnInitialized()
    {
        GenerateNumbers();
    }

    //number gen and clear past user input
    private void GenerateNumbers()
    {
        Random random = new Random();
        num1 = random.Next(1, 20);
        num2 = random.Next(1, 20);
        userAnswer = null;
    }

    //presss enterrrr
    private async Task HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await CheckAnswer();
        }
    }

    private void YouWin()
    {
        NavigationManager.NavigateTo("/You-Win-1");
    }

    private void YouLose()
    {
        NavigationManager.NavigateTo("/You-Lose");
    }

    //check the userinput and updates whatever is diaplayed
    private async Task CheckAnswer()
    {
        showResult = true;
        if (userAnswer == num1 + num2)
        {
            //correct answer wooo, enemy health -1
            resultMessage = "Yes";
            GenerateNumbers();
            enemyOnehp = Math.Max(enemyOnehp - 1, 0); //this bit shows that the boss hp cannot be below 0 :)

            if (enemyOnehp == 0)
            {
                //you win screen
                YouWin();

                var currentLevel = await localStorage.GetItemAsync<int>(Level);
                if (currentLevel == 0)
                {
                    await localStorage.SetItemAsync(Level, GameLevel.Level1);
                }
            }
        }
        else
        {
            //wrong answer oh no, player health -1
            resultMessage = "Skill issue(try again)";
            mainChp = Math.Max(mainChp - 1, 0); //this bit shows that the mc hp cannot be below 0 :) also after this call the method for likr, removing one of the blocks of hp

            if (mainChp == 0)
            {
                //you lose screen
                YouLose();
            }
        }
    }

}
